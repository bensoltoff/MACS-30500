<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Getting data from the web: API access</title>
    <meta charset="utf-8" />
    <meta name="author" content="INFO 5940   Cornell University" />
    <script src="index_files/header-attrs/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Getting data from the web: API access
]
.author[
### INFO 5940 <br /> Cornell University
]

---






class: inverse, middle

# Methods for obtaining data online

---

## Methods for obtaining data online

* Click and download
* Install and play
* API query
* Scraping

---

## Click and download

* `read.csv` or `readr::read_csv`
* `downloader` package or `curl`

---

## Application programming interface (API)

- Representational State Transfer (REST)
- Uniform Resource Location (URL)
- HTTP methods
    - GET
    - POST

---

## Application programming interface (API)

&lt;img src="../../../../../../../../img/wikipedia.png" width="80%" style="display: block; margin: auto;" /&gt;

---

## RESTful queries

1. Submit request to server via URL
1. Return result in a structured format
1. Parse results into a local format

---

## Install and play packages

* Packages with R functions written for existing APIs
* Useful because
    * Reproducible
    * Up-to-date (ideally)
    * Ease of access

---

class: inverse, middle

# Using APIs with existing R packages

---

## `manifestoR`

* Collects and organizes political party manifestos from around the world
* Over 1000 parties from 1945 until today in over 50 countries on five continents
* [`manifestoR`](https://github.com/ManifestoProject/manifestoR)

---

## API authentication

* Key/token
* Obtain key
* Store in `.Rprofile`


```r
# in .Rprofile
options(this_is_my_key = "XXXX")

# later, in the R script:
key &lt;- getOption("this_is_my_key")
```

--

* `usethis::edit_r_profile()`
* Read the documentation - different packages have different storage methods

---

## Load library and set API key


```r
library(manifestoR)

# retrieve API key stored in .Rprofile
mp_setapikey(key = getOption("manifesto_key"))
```

---

## Retrieve the database


```r
(mpds &lt;- mp_maindataset())
```

```
## Connecting to Manifesto Project DB API... 
## Connecting to Manifesto Project DB API... corpus version: 2022-1
```

```
## # A tibble: 4,778 √ó 174
##    country countryname oecdmem‚Ä¶¬π eumem‚Ä¶¬≤ edate        date party party‚Ä¶¬≥ party‚Ä¶‚Å¥
##      &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;   &lt;dbl&gt; &lt;date&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  
##  1      11 Sweden              0       0 1944-09-17 194409 11220 Commun‚Ä¶ "SKP"  
##  2      11 Sweden              0       0 1944-09-17 194409 11320 Social‚Ä¶ "SAP"  
##  3      11 Sweden              0       0 1944-09-17 194409 11420 People‚Ä¶ "FP"   
##  4      11 Sweden              0       0 1944-09-17 194409 11620 Right ‚Ä¶ ""     
##  5      11 Sweden              0       0 1944-09-17 194409 11810 Agrari‚Ä¶ ""     
##  6      11 Sweden              0       0 1948-09-19 194809 11220 Commun‚Ä¶ "SKP"  
##  7      11 Sweden              0       0 1948-09-19 194809 11320 Social‚Ä¶ "SAP"  
##  8      11 Sweden              0       0 1948-09-19 194809 11420 People‚Ä¶ "FP"   
##  9      11 Sweden              0       0 1948-09-19 194809 11620 Right ‚Ä¶ ""     
## 10      11 Sweden              0       0 1948-09-19 194809 11810 Agrari‚Ä¶ ""     
## # ‚Ä¶ with 4,768 more rows, 165 more variables: parfam &lt;dbl&gt;, coderid &lt;dbl&gt;,
## #   manual &lt;dbl&gt;, coderyear &lt;dbl&gt;, testresult &lt;dbl&gt;, testeditsim &lt;dbl&gt;,
## #   pervote &lt;dbl&gt;, voteest &lt;dbl&gt;, presvote &lt;dbl&gt;, absseat &lt;dbl&gt;,
## #   totseats &lt;dbl&gt;, progtype &lt;dbl&gt;, datasetorigin &lt;dbl&gt;, corpusversion &lt;chr&gt;,
## #   total &lt;dbl&gt;, peruncod &lt;dbl&gt;, per101 &lt;dbl&gt;, per102 &lt;dbl&gt;, per103 &lt;dbl&gt;,
## #   per104 &lt;dbl&gt;, per105 &lt;dbl&gt;, per106 &lt;dbl&gt;, per107 &lt;dbl&gt;, per108 &lt;dbl&gt;,
## #   per109 &lt;dbl&gt;, per110 &lt;dbl&gt;, per201 &lt;dbl&gt;, per202 &lt;dbl&gt;, per203 &lt;dbl&gt;, ‚Ä¶
```

---

&lt;img src="index_files/figure-html/manifesto-dist-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

## Download manifestos



&lt;img src="index_files/figure-html/manifestor-corpus-wordcloud-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

## Census data with `tidycensus`

* API to access data from US Census Bureau
    * Decennial census
    * American Community Survey
* Returns tidy data frames with (optional) `sf` geometry
* Search for variables with `load_variables()`

---

## Store API key


```r
library(tidycensus)
```

```r
census_api_key("YOUR API KEY GOES HERE")
```

---

## Obtain data


```r
usa_inc &lt;- get_acs(
  geography = "state",
  variables = c(medincome = "B19013_001"),
  year = 2020
)
usa_inc
```

```
## # A tibble: 52 √ó 5
##    GEOID NAME                 variable  estimate   moe
##    &lt;chr&gt; &lt;chr&gt;                &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;
##  1 01    Alabama              medincome    52035   377
##  2 02    Alaska               medincome    77790  1134
##  3 04    Arizona              medincome    61529   286
##  4 05    Arkansas             medincome    49475   431
##  5 06    California           medincome    78672   270
##  6 08    Colorado             medincome    75231   379
##  7 09    Connecticut          medincome    79855   587
##  8 10    Delaware             medincome    69110  1112
##  9 11    District of Columbia medincome    90842  1580
## 10 12    Florida              medincome    57703   269
## # ‚Ä¶ with 42 more rows
```

---

## Visualize data

&lt;img src="index_files/figure-html/income-usa-plot-1.png" width="70%" style="display: block; margin: auto;" /&gt;

---

# Twitter API

* REST API
* Streaming API


--

* [`rtweet`](https://docs.ropensci.org/rtweet/)

---

# Using `rtweet`


```r
library(rtweet)
```

* Requires a Twitter account
* Prompt to authorize application on first usage

---


# Searching tweets


```r
rt &lt;- search_tweets(
  q = "#rstats",
  n = 3000,
  include_rts = FALSE
)
rt
```

```
## # A tibble: 1,021 √ó 43
##    created_at               id id_str       full_‚Ä¶¬π trunc‚Ä¶¬≤ displ‚Ä¶¬≥ entities    
##    &lt;dttm&gt;                &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;   &lt;lgl&gt;     &lt;dbl&gt; &lt;list&gt;      
##  1 2022-10-03 13:39:02 1.58e18 15769902220‚Ä¶ "C√≥dig‚Ä¶ FALSE       165 &lt;named list&gt;
##  2 2022-10-03 09:38:00 1.58e18 15769295627‚Ä¶ "I wan‚Ä¶ FALSE       135 &lt;named list&gt;
##  3 2022-09-29 00:51:18 1.58e18 15753474632‚Ä¶ "The c‚Ä¶ FALSE       272 &lt;named list&gt;
##  4 2022-10-05 11:32:28 1.58e18 15776831442‚Ä¶ "Me re‚Ä¶ FALSE        51 &lt;named list&gt;
##  5 2022-10-05 11:27:54 1.58e18 15776819973‚Ä¶ "Wie m‚Ä¶ FALSE        95 &lt;named list&gt;
##  6 2022-10-05 11:27:29 1.58e18 15776818927‚Ä¶ "Metap‚Ä¶ FALSE        71 &lt;named list&gt;
##  7 2022-10-05 11:23:00 1.58e18 15776807620‚Ä¶ "üé´ Do‚Ä¶ FALSE       285 &lt;named list&gt;
##  8 2022-10-05 11:22:54 1.58e18 15776807400‚Ä¶ "Here‚Äô‚Ä¶ FALSE       210 &lt;named list&gt;
##  9 2022-10-05 11:22:39 1.58e18 15776806760‚Ä¶ "Daily‚Ä¶ FALSE       198 &lt;named list&gt;
## 10 2022-10-05 11:21:55 1.58e18 15776804886‚Ä¶ "Image‚Ä¶ FALSE        73 &lt;named list&gt;
## # ‚Ä¶ with 1,011 more rows, 36 more variables: metadata &lt;list&gt;, source &lt;chr&gt;,
## #   in_reply_to_status_id &lt;dbl&gt;, in_reply_to_status_id_str &lt;chr&gt;,
## #   in_reply_to_user_id &lt;dbl&gt;, in_reply_to_user_id_str &lt;chr&gt;,
## #   in_reply_to_screen_name &lt;chr&gt;, geo &lt;list&gt;, coordinates &lt;list&gt;,
## #   place &lt;list&gt;, contributors &lt;lgl&gt;, is_quote_status &lt;lgl&gt;,
## #   retweet_count &lt;int&gt;, favorite_count &lt;int&gt;, favorited &lt;lgl&gt;,
## #   retweeted &lt;lgl&gt;, possibly_sensitive &lt;lgl&gt;, lang &lt;chr&gt;, ‚Ä¶
```

---

# Searching users


```r
countvoncount &lt;- get_timeline(user = "countvoncount", n = 4000)
countvoncount
```

```
## # A tibble: 3,250 √ó 43
##    created_at               id id_str       full_‚Ä¶¬π trunc‚Ä¶¬≤ displ‚Ä¶¬≥ entities    
##    &lt;dttm&gt;                &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;   &lt;lgl&gt;     &lt;dbl&gt; &lt;list&gt;      
##  1 2022-10-04 22:52:10 1.58e18 15774918103‚Ä¶ Three ‚Ä¶ FALSE        42 &lt;named list&gt;
##  2 2022-10-04 16:52:10 1.58e18 15774012115‚Ä¶ Three ‚Ä¶ FALSE        40 &lt;named list&gt;
##  3 2022-10-04 11:52:09 1.58e18 15773257125‚Ä¶ Three ‚Ä¶ FALSE        41 &lt;named list&gt;
##  4 2022-10-03 20:52:08 1.58e18 15770992154‚Ä¶ Three ‚Ä¶ FALSE        51 &lt;named list&gt;
##  5 2022-10-03 10:52:08 1.58e18 15769482177‚Ä¶ Three ‚Ä¶ FALSE        42 &lt;named list&gt;
##  6 2022-10-02 22:52:07 1.58e18 15767670198‚Ä¶ Three ‚Ä¶ FALSE        40 &lt;named list&gt;
##  7 2022-10-02 12:52:06 1.58e18 15766160220‚Ä¶ Three ‚Ä¶ FALSE        40 &lt;named list&gt;
##  8 2022-10-01 15:52:04 1.58e18 15762989262‚Ä¶ Three ‚Ä¶ FALSE        36 &lt;named list&gt;
##  9 2022-09-30 22:52:03 1.58e18 15760422298‚Ä¶ Three ‚Ä¶ FALSE        38 &lt;named list&gt;
## 10 2022-09-30 15:52:03 1.58e18 15759365312‚Ä¶ Three ‚Ä¶ FALSE        38 &lt;named list&gt;
## # ‚Ä¶ with 3,240 more rows, 36 more variables: source &lt;chr&gt;,
## #   in_reply_to_status_id &lt;lgl&gt;, in_reply_to_status_id_str &lt;lgl&gt;,
## #   in_reply_to_user_id &lt;lgl&gt;, in_reply_to_user_id_str &lt;lgl&gt;,
## #   in_reply_to_screen_name &lt;lgl&gt;, geo &lt;list&gt;, coordinates &lt;list&gt;,
## #   place &lt;list&gt;, contributors &lt;lgl&gt;, is_quote_status &lt;lgl&gt;,
## #   retweet_count &lt;int&gt;, favorite_count &lt;int&gt;, favorited &lt;lgl&gt;,
## #   retweeted &lt;lgl&gt;, lang &lt;chr&gt;, possibly_sensitive &lt;list&gt;, ‚Ä¶
```

---

# Visualizing tweets


```r
ts_plot(countvoncount, by = "1 week")
```

&lt;img src="index_files/figure-html/rstats-freq-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

# Visualizing tweets



```r
ts_plot(countvoncount, by = "1 month")
```

&lt;img src="index_files/figure-html/rstats-freq-day-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

# Visualizing tweets


```r
ts_plot(countvoncount, by = "1 week") +
  theme(plot.title = element_text(face = "bold")) +
  labs(
    x = NULL, y = NULL,
    title = "Frequency of @countvoncount Twitter posts",
    subtitle = "Twitter status (tweet) counts aggregated using one week intervals",
    caption = "\nSource: Data collected from Twitter's REST API via rtweet"
  )
```

&lt;img src="index_files/figure-html/rstats-freq-clean-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

# Exercise: Practice using `rtweet`

.pull-left[

&lt;img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/21/Katy_Perry%E2%80%93Zenith_Paris.jpg/360px-Katy_Perry%E2%80%93Zenith_Paris.jpg" width="80%" style="display: block; margin: auto;" /&gt;

]

.pull-right[

&lt;img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/df/Kim_Kardashian_West_2014.jpg/320px-Kim_Kardashian_West_2014.jpg" width="80%" style="display: block; margin: auto;" /&gt;

]

---

class: inverse, middle

# Writing an API function

---

## Writing an API function

* No package for API
* Write your own function!
* [Open Movie Database](http://www.omdbapi.com/)

---

class: center, middle

&lt;iframe width="840" height="473" src="https://www.youtube.com/embed/9LmAEVdPhl4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen&gt;&lt;/iframe&gt;

---

## Expected elements

1. Authentication Key/Token
1. Base URL
1. Search Parameters
1. Response Format

---

## Determine the shape of an API request

[Use the documentation](https://www.omdbapi.com/#examples)

--

```http
http://www.omdbapi.com/?apikey=[apikey]&amp;t=Sharknado&amp;y=2013
```


```
## {
##     "Title": "Sharknado",
##     "Year": "2013",
##     "Rated": "Not Rated",
##     "Released": "11 Jul 2013",
##     "Runtime": "86 min",
##     "Genre": "Action, Adventure, Comedy",
##     "Director": "Anthony C. Ferrante",
##     "Writer": "Thunder Levin",
##     "Actors": "Ian Ziering, Tara Reid, John Heard",
##     "Plot": "When a freak hurricane swamps Los Angeles, nature's deadliest killer rules sea, land, and air as thousands of sharks terrorize the waterlogged populace.",
##     "Language": "English",
##     "Country": "United States",
##     "Awards": "1 win &amp; 2 nominations",
##     "Poster": "https://m.media-amazon.com/images/M/MV5BODcwZWFiNTEtNDgzMC00ZmE2LWExMzYtNzZhZDgzNDc5NDkyXkEyXkFqcGdeQXVyMTQxNzMzNDI@._V1_SX300.jpg",
##     "Ratings": [
##         {
##             "Source": "Internet Movie Database",
##             "Value": "3.3/10"
##         },
##         {
##             "Source": "Rotten Tomatoes",
##             "Value": "74%"
##         }
##     ],
##     "Metascore": "N/A",
##     "imdbRating": "3.3",
##     "imdbVotes": "50,032",
##     "imdbID": "tt2724064",
##     "Type": "movie",
##     "DVD": "03 Sep 2013",
##     "BoxOffice": "N/A",
##     "Production": "N/A",
##     "Website": "N/A",
##     "Response": "True"
## }
## 
```

---

## `httr::GET()`


```r
sharknado &lt;- GET(url = "http://www.omdbapi.com/?",
    query = list(t = "Sharknado",
                 y = 2013,
                 apikey = getOption("omdb_key"))
)
```

---

## JavaScript Object Notation (JSON)


```
## {
##     "Title": "Sharknado",
##     "Year": "2013",
##     "Rated": "Not Rated",
##     "Released": "11 Jul 2013",
##     "Runtime": "86 min",
##     "Genre": "Action, Adventure, Comedy",
##     "Director": "Anthony C. Ferrante",
##     "Writer": "Thunder Levin",
##     "Actors": "Ian Ziering, Tara Reid, John Heard",
##     "Plot": "When a freak hurricane swamps Los Angeles, nature's deadliest killer rules sea, land, and air as thousands of sharks terrorize the waterlogged populace.",
##     "Language": "English",
##     "Country": "United States",
##     "Awards": "1 win &amp; 2 nominations",
##     "Poster": "https://m.media-amazon.com/images/M/MV5BODcwZWFiNTEtNDgzMC00ZmE2LWExMzYtNzZhZDgzNDc5NDkyXkEyXkFqcGdeQXVyMTQxNzMzNDI@._V1_SX300.jpg",
##     "Ratings": [
##         {
##             "Source": "Internet Movie Database",
##             "Value": "3.3/10"
##         },
##         {
##             "Source": "Rotten Tomatoes",
##             "Value": "74%"
##         }
##     ],
##     "Metascore": "N/A",
##     "imdbRating": "3.3",
##     "imdbVotes": "49,884",
##     "imdbID": "tt2724064",
##     "Type": "movie",
##     "DVD": "03 Sep 2013",
##     "BoxOffice": "N/A",
##     "Production": "N/A",
##     "Website": "N/A",
##     "Response": "True"
## }
## 
```

---

## JSON


```r
sharknado_df &lt;- content(sharknado) %&gt;%
  as_tibble()
sharknado_df
```

```
## # A tibble: 2 √ó 25
##   Title    Year  Rated Relea‚Ä¶¬π Runtime Genre Direc‚Ä¶¬≤ Writer Actors Plot  Langu‚Ä¶¬≥
##   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  
## 1 Sharkna‚Ä¶ 2013  Not ‚Ä¶ 11 Jul‚Ä¶ 86 min  Acti‚Ä¶ Anthon‚Ä¶ Thund‚Ä¶ Ian Z‚Ä¶ When‚Ä¶ English
## 2 Sharkna‚Ä¶ 2013  Not ‚Ä¶ 11 Jul‚Ä¶ 86 min  Acti‚Ä¶ Anthon‚Ä¶ Thund‚Ä¶ Ian Z‚Ä¶ When‚Ä¶ English
## # ‚Ä¶ with 14 more variables: Country &lt;chr&gt;, Awards &lt;chr&gt;, Poster &lt;chr&gt;,
## #   Ratings &lt;list&gt;, Metascore &lt;chr&gt;, imdbRating &lt;chr&gt;, imdbVotes &lt;chr&gt;,
## #   imdbID &lt;chr&gt;, Type &lt;chr&gt;, DVD &lt;chr&gt;, BoxOffice &lt;chr&gt;, Production &lt;chr&gt;,
## #   Website &lt;chr&gt;, Response &lt;chr&gt;, and abbreviated variable names ¬π‚ÄãReleased,
## #   ¬≤‚ÄãDirector, ¬≥‚ÄãLanguage
```

---

## Additional information from `GET()`


```r
sharknado$url
```


```
## [1] "http://www.omdbapi.com/?t=Sharknado&amp;y=2013&amp;apikey=[apikey]"
```

--


```r
status_code(sharknado)
```

```
## [1] 200
```

---

## HTTP status code

Code | Status
-------|--------|
1xx    | Informational
2xx    | Success
3xx    | Redirection
4xx    | Client error (you did something wrong)
5xx    | Server error (server did something wrong)

&gt; [A more intuitive guide](https://www.flickr.com/photos/girliemac/sets/72157628409467125)

---

## Iteration through a set of movies


```r
omdb_api &lt;- function(title, api_key){
  # send GET request
  response &lt;- GET(url = "http://www.omdbapi.com/?",
    query = list(t = title,
                 apikey = api_key)
  )
  
  # parse response to JSON
  response_df &lt;- content(response) %&gt;%
    as_tibble()
  
  # print a message to track progress
  message(glue::glue("Scraping {title}..."))
  
  return(response_df)
}
```

---

## Iteration through a set of movies


```r
sharknados &lt;- c("Sharknado", "Sharknado 2", "Sharknado 3",
                "Sharknado 4", "Sharknado 5")
```


```r
# modify function to delay by one second
omdb_api_slow &lt;- purrr::slowly(f = omdb_api, rate = rate_delay(1))

# iterate over all the films
sharknados_df &lt;- map_dfr(.x = sharknados, .f = omdb_api_slow, api_key = getOption("omdb_key"))
```

```
## Scraping Sharknado...
```

```
## Scraping Sharknado 2...
```

```
## Scraping Sharknado 3...
```

```
## Scraping Sharknado 4...
```

```
## Scraping Sharknado 5...
```

---

## Iteration through a set of movies


```r
sharknados_df
```

```
## # A tibble: 10 √ó 25
##    Title   Year  Rated Relea‚Ä¶¬π Runtime Genre Direc‚Ä¶¬≤ Writer Actors Plot  Langu‚Ä¶¬≥
##    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  
##  1 Sharkn‚Ä¶ 2013  Not ‚Ä¶ 11 Jul‚Ä¶ 86 min  Acti‚Ä¶ Anthon‚Ä¶ Thund‚Ä¶ Ian Z‚Ä¶ When‚Ä¶ English
##  2 Sharkn‚Ä¶ 2013  Not ‚Ä¶ 11 Jul‚Ä¶ 86 min  Acti‚Ä¶ Anthon‚Ä¶ Thund‚Ä¶ Ian Z‚Ä¶ When‚Ä¶ English
##  3 Sharkn‚Ä¶ 2014  TV-14 30 Jul‚Ä¶ 95 min  Acti‚Ä¶ Anthon‚Ä¶ Thund‚Ä¶ Ian Z‚Ä¶ Fin ‚Ä¶ English
##  4 Sharkn‚Ä¶ 2014  TV-14 30 Jul‚Ä¶ 95 min  Acti‚Ä¶ Anthon‚Ä¶ Thund‚Ä¶ Ian Z‚Ä¶ Fin ‚Ä¶ English
##  5 Sharkn‚Ä¶ 2015  TV-14 22 Jul‚Ä¶ 93 min  Acti‚Ä¶ Anthon‚Ä¶ Thund‚Ä¶ Ian Z‚Ä¶ A mo‚Ä¶ English
##  6 Sharkn‚Ä¶ 2015  TV-14 22 Jul‚Ä¶ 93 min  Acti‚Ä¶ Anthon‚Ä¶ Thund‚Ä¶ Ian Z‚Ä¶ A mo‚Ä¶ English
##  7 Sharkn‚Ä¶ 2016  TV-14 31 Jul‚Ä¶ 95 min  Acti‚Ä¶ Anthon‚Ä¶ Thund‚Ä¶ Ian Z‚Ä¶ Fin,‚Ä¶ English
##  8 Sharkn‚Ä¶ 2016  TV-14 31 Jul‚Ä¶ 95 min  Acti‚Ä¶ Anthon‚Ä¶ Thund‚Ä¶ Ian Z‚Ä¶ Fin,‚Ä¶ English
##  9 Sharkn‚Ä¶ 2017  TV-14 06 Aug‚Ä¶ 93 min  Acti‚Ä¶ Anthon‚Ä¶ Thund‚Ä¶ Ian Z‚Ä¶ With‚Ä¶ English
## 10 Sharkn‚Ä¶ 2017  TV-14 06 Aug‚Ä¶ 93 min  Acti‚Ä¶ Anthon‚Ä¶ Thund‚Ä¶ Ian Z‚Ä¶ With‚Ä¶ English
## # ‚Ä¶ with 14 more variables: Country &lt;chr&gt;, Awards &lt;chr&gt;, Poster &lt;chr&gt;,
## #   Ratings &lt;list&gt;, Metascore &lt;chr&gt;, imdbRating &lt;chr&gt;, imdbVotes &lt;chr&gt;,
## #   imdbID &lt;chr&gt;, Type &lt;chr&gt;, DVD &lt;chr&gt;, BoxOffice &lt;chr&gt;, Production &lt;chr&gt;,
## #   Website &lt;chr&gt;, Response &lt;chr&gt;, and abbreviated variable names ¬π‚ÄãReleased,
## #   ¬≤‚ÄãDirector, ¬≥‚ÄãLanguage
```

---

## Messy API responses


```r
content(sharknado) %&gt;%
  as_tibble()
```

```
## # A tibble: 2 √ó 25
##   Title    Year  Rated Relea‚Ä¶¬π Runtime Genre Direc‚Ä¶¬≤ Writer Actors Plot  Langu‚Ä¶¬≥
##   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  
## 1 Sharkna‚Ä¶ 2013  Not ‚Ä¶ 11 Jul‚Ä¶ 86 min  Acti‚Ä¶ Anthon‚Ä¶ Thund‚Ä¶ Ian Z‚Ä¶ When‚Ä¶ English
## 2 Sharkna‚Ä¶ 2013  Not ‚Ä¶ 11 Jul‚Ä¶ 86 min  Acti‚Ä¶ Anthon‚Ä¶ Thund‚Ä¶ Ian Z‚Ä¶ When‚Ä¶ English
## # ‚Ä¶ with 14 more variables: Country &lt;chr&gt;, Awards &lt;chr&gt;, Poster &lt;chr&gt;,
## #   Ratings &lt;list&gt;, Metascore &lt;chr&gt;, imdbRating &lt;chr&gt;, imdbVotes &lt;chr&gt;,
## #   imdbID &lt;chr&gt;, Type &lt;chr&gt;, DVD &lt;chr&gt;, BoxOffice &lt;chr&gt;, Production &lt;chr&gt;,
## #   Website &lt;chr&gt;, Response &lt;chr&gt;, and abbreviated variable names ¬π‚ÄãReleased,
## #   ¬≤‚ÄãDirector, ¬≥‚ÄãLanguage
```

---

## Whoops


```
## List of 25
##  $ Title     : chr "Sharknado"
##  $ Year      : chr "2013"
##  $ Rated     : chr "Not Rated"
##  $ Released  : chr "11 Jul 2013"
##  $ Runtime   : chr "86 min"
##  $ Genre     : chr "Action, Adventure, Comedy"
##  $ Director  : chr "Anthony C. Ferrante"
##  $ Writer    : chr "Thunder Levin"
##  $ Actors    : chr "Ian Ziering, Tara Reid, John Heard"
##  $ Plot      : chr "When a freak hurricane swamps Los Angeles, nature's deadliest killer rules sea, land, and air as thousands of s"| __truncated__
##  $ Language  : chr "English"
##  $ Country   : chr "United States"
##  $ Awards    : chr "1 win &amp; 2 nominations"
##  $ Poster    : chr "https://m.media-amazon.com/images/M/MV5BODcwZWFiNTEtNDgzMC00ZmE2LWExMzYtNzZhZDgzNDc5NDkyXkEyXkFqcGdeQXVyMTQxNzM"| __truncated__
##  $ Ratings   :List of 2
##   ..$ :List of 2
##   .. ..$ Source: chr "Internet Movie Database"
##   .. ..$ Value : chr "3.3/10"
##   ..$ :List of 2
##   .. ..$ Source: chr "Rotten Tomatoes"
##   .. ..$ Value : chr "74%"
##  $ Metascore : chr "N/A"
##  $ imdbRating: chr "3.3"
##  $ imdbVotes : chr "49,884"
##  $ imdbID    : chr "tt2724064"
##  $ Type      : chr "movie"
##  $ DVD       : chr "03 Sep 2013"
##  $ BoxOffice : chr "N/A"
##  $ Production: chr "N/A"
##  $ Website   : chr "N/A"
##  $ Response  : chr "True"
```

---

class: inverse, middle

# Rectangling messy data

---

## Rectangling and `tidyr`

.task[
Art and craft of taking a deeply nested list and taming it into a tidy data set of rows and columns
]

--

* `unnest_longer()` - each row contains multiple observations
* `unnest_wider()` - each row contains a single observation
* `unnest_auto()` - make an educated guess
* `hoist()` - extract a specific element
  
---

## `unnest_wider()` and `hoist()`


```r
str(gh_users, list.len = 3)
```

```
## List of 6
##  $ :List of 30
##   ..$ login              : chr "gaborcsardi"
##   ..$ id                 : int 660288
##   ..$ avatar_url         : chr "https://avatars.githubusercontent.com/u/660288?v=3"
##   .. [list output truncated]
##  $ :List of 30
##   ..$ login              : chr "jennybc"
##   ..$ id                 : int 599454
##   ..$ avatar_url         : chr "https://avatars.githubusercontent.com/u/599454?v=3"
##   .. [list output truncated]
##  $ :List of 30
##   ..$ login              : chr "jtleek"
##   ..$ id                 : int 1571674
##   ..$ avatar_url         : chr "https://avatars.githubusercontent.com/u/1571674?v=3"
##   .. [list output truncated]
##   [list output truncated]
```

---

## `unnest_wider()` and `hoist()`


```r
(users &lt;- tibble(user = gh_users))
```

```
## # A tibble: 6 √ó 1
##   user             
##   &lt;list&gt;           
## 1 &lt;named list [30]&gt;
## 2 &lt;named list [30]&gt;
## 3 &lt;named list [30]&gt;
## 4 &lt;named list [30]&gt;
## 5 &lt;named list [30]&gt;
## 6 &lt;named list [30]&gt;
```

--


```r
names(users$user[[1]])
```

```
##  [1] "login"               "id"                  "avatar_url"         
##  [4] "gravatar_id"         "url"                 "html_url"           
##  [7] "followers_url"       "following_url"       "gists_url"          
## [10] "starred_url"         "subscriptions_url"   "organizations_url"  
## [13] "repos_url"           "events_url"          "received_events_url"
## [16] "type"                "site_admin"          "name"               
## [19] "company"             "blog"                "location"           
## [22] "email"               "hireable"            "bio"                
## [25] "public_repos"        "public_gists"        "followers"          
## [28] "following"           "created_at"          "updated_at"
```

---

## `unnest_wider()`


```r
users %&gt;%
  unnest_wider(col = user)
```

```
## # A tibble: 6 √ó 30
##   login         id avata‚Ä¶¬π grava‚Ä¶¬≤ url   html_‚Ä¶¬≥ follo‚Ä¶‚Å¥ follo‚Ä¶‚Åµ gists‚Ä¶‚Å∂ starr‚Ä¶‚Å∑
##   &lt;chr&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
## 1 gaborcsa‚Ä¶ 6.60e5 https:‚Ä¶ ""      http‚Ä¶ https:‚Ä¶ https:‚Ä¶ https:‚Ä¶ https:‚Ä¶ https:‚Ä¶
## 2 jennybc   5.99e5 https:‚Ä¶ ""      http‚Ä¶ https:‚Ä¶ https:‚Ä¶ https:‚Ä¶ https:‚Ä¶ https:‚Ä¶
## 3 jtleek    1.57e6 https:‚Ä¶ ""      http‚Ä¶ https:‚Ä¶ https:‚Ä¶ https:‚Ä¶ https:‚Ä¶ https:‚Ä¶
## 4 juliasil‚Ä¶ 1.25e7 https:‚Ä¶ ""      http‚Ä¶ https:‚Ä¶ https:‚Ä¶ https:‚Ä¶ https:‚Ä¶ https:‚Ä¶
## 5 leeper    3.51e6 https:‚Ä¶ ""      http‚Ä¶ https:‚Ä¶ https:‚Ä¶ https:‚Ä¶ https:‚Ä¶ https:‚Ä¶
## 6 masalmon  8.36e6 https:‚Ä¶ ""      http‚Ä¶ https:‚Ä¶ https:‚Ä¶ https:‚Ä¶ https:‚Ä¶ https:‚Ä¶
## # ‚Ä¶ with 20 more variables: subscriptions_url &lt;chr&gt;, organizations_url &lt;chr&gt;,
## #   repos_url &lt;chr&gt;, events_url &lt;chr&gt;, received_events_url &lt;chr&gt;, type &lt;chr&gt;,
## #   site_admin &lt;lgl&gt;, name &lt;chr&gt;, company &lt;chr&gt;, blog &lt;chr&gt;, location &lt;chr&gt;,
## #   email &lt;chr&gt;, hireable &lt;lgl&gt;, bio &lt;chr&gt;, public_repos &lt;int&gt;,
## #   public_gists &lt;int&gt;, followers &lt;int&gt;, following &lt;int&gt;, created_at &lt;chr&gt;,
## #   updated_at &lt;chr&gt;, and abbreviated variable names ¬π‚Äãavatar_url, ¬≤‚Äãgravatar_id,
## #   ¬≥‚Äãhtml_url, ‚Å¥‚Äãfollowers_url, ‚Åµ‚Äãfollowing_url, ‚Å∂‚Äãgists_url, ‚Å∑‚Äãstarred_url
```

---

## `hoist()`


```r
users %&gt;%
  hoist(
    .col = user,
    followers = "followers",
    login = "login",
    url = "html_url"
  )
```

```
## # A tibble: 6 √ó 4
##   followers login       url                            user             
##       &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;                          &lt;list&gt;           
## 1       303 gaborcsardi https://github.com/gaborcsardi &lt;named list [27]&gt;
## 2       780 jennybc     https://github.com/jennybc     &lt;named list [27]&gt;
## 3      3958 jtleek      https://github.com/jtleek      &lt;named list [27]&gt;
## 4       115 juliasilge  https://github.com/juliasilge  &lt;named list [27]&gt;
## 5       213 leeper      https://github.com/leeper      &lt;named list [27]&gt;
## 6        34 masalmon    https://github.com/masalmon    &lt;named list [27]&gt;
```

---

## `gh_repos` and nested list structures


```r
(repos &lt;- tibble(repo = gh_repos))
```

```
## # A tibble: 6 √ó 1
##   repo       
##   &lt;list&gt;     
## 1 &lt;list [30]&gt;
## 2 &lt;list [30]&gt;
## 3 &lt;list [30]&gt;
## 4 &lt;list [26]&gt;
## 5 &lt;list [30]&gt;
## 6 &lt;list [30]&gt;
```

---

## `unnest_longer()`


```r
repos &lt;- repos %&gt;%
  unnest_longer(col = repo)
repos
```

```
## # A tibble: 176 √ó 1
##    repo             
##    &lt;list&gt;           
##  1 &lt;named list [68]&gt;
##  2 &lt;named list [68]&gt;
##  3 &lt;named list [68]&gt;
##  4 &lt;named list [68]&gt;
##  5 &lt;named list [68]&gt;
##  6 &lt;named list [68]&gt;
##  7 &lt;named list [68]&gt;
##  8 &lt;named list [68]&gt;
##  9 &lt;named list [68]&gt;
## 10 &lt;named list [68]&gt;
## # ‚Ä¶ with 166 more rows
```

---

## `unnest_longer()`


```r
repos %&gt;%
  hoist(
    .col = repo,
    login = c("owner", "login"),
    name = "name",
    homepage = "homepage",
    watchers = "watchers_count"
  )
```

```
## # A tibble: 176 √ó 5
##    login       name        homepage watchers repo             
##    &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;int&gt; &lt;list&gt;           
##  1 gaborcsardi after       &lt;NA&gt;            5 &lt;named list [65]&gt;
##  2 gaborcsardi argufy      &lt;NA&gt;           19 &lt;named list [65]&gt;
##  3 gaborcsardi ask         &lt;NA&gt;            5 &lt;named list [65]&gt;
##  4 gaborcsardi baseimports &lt;NA&gt;            0 &lt;named list [65]&gt;
##  5 gaborcsardi citest      &lt;NA&gt;            0 &lt;named list [65]&gt;
##  6 gaborcsardi clisymbols  ""             18 &lt;named list [65]&gt;
##  7 gaborcsardi cmaker      &lt;NA&gt;            0 &lt;named list [65]&gt;
##  8 gaborcsardi cmark       &lt;NA&gt;            0 &lt;named list [65]&gt;
##  9 gaborcsardi conditions  &lt;NA&gt;            0 &lt;named list [65]&gt;
## 10 gaborcsardi crayon      &lt;NA&gt;           52 &lt;named list [65]&gt;
## # ‚Ä¶ with 166 more rows
```

---



count: false
 

.panel1-gh-repos-auto-auto[

```r
*tibble(repo = gh_repos)
```
]
 
.panel2-gh-repos-auto-auto[

```
## # A tibble: 6 √ó 1
##   repo       
##   &lt;list&gt;     
## 1 &lt;list [30]&gt;
## 2 &lt;list [30]&gt;
## 3 &lt;list [30]&gt;
## 4 &lt;list [26]&gt;
## 5 &lt;list [30]&gt;
## 6 &lt;list [30]&gt;
```
]

---
count: false
 

.panel1-gh-repos-auto-auto[

```r
tibble(repo = gh_repos) %&gt;%
* unnest_auto(col = repo)
```
]
 
.panel2-gh-repos-auto-auto[

```
## # A tibble: 176 √ó 1
##    repo             
##    &lt;list&gt;           
##  1 &lt;named list [68]&gt;
##  2 &lt;named list [68]&gt;
##  3 &lt;named list [68]&gt;
##  4 &lt;named list [68]&gt;
##  5 &lt;named list [68]&gt;
##  6 &lt;named list [68]&gt;
##  7 &lt;named list [68]&gt;
##  8 &lt;named list [68]&gt;
##  9 &lt;named list [68]&gt;
## 10 &lt;named list [68]&gt;
## # ‚Ä¶ with 166 more rows
```
]

---
count: false
 

.panel1-gh-repos-auto-auto[

```r
tibble(repo = gh_repos) %&gt;%
  unnest_auto(col = repo) %&gt;%
* unnest_auto(col = repo)
```
]
 
.panel2-gh-repos-auto-auto[

```
## # A tibble: 176 √ó 68
##         id name  full_name owner        private html_url description fork  url  
##      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;list&gt;       &lt;lgl&gt;   &lt;chr&gt;    &lt;chr&gt;       &lt;lgl&gt; &lt;chr&gt;
##  1  6.12e7 after gaborcsa‚Ä¶ &lt;named list&gt; FALSE   https:/‚Ä¶ Run Code i‚Ä¶ FALSE http‚Ä¶
##  2  4.05e7 argu‚Ä¶ gaborcsa‚Ä¶ &lt;named list&gt; FALSE   https:/‚Ä¶ Declarativ‚Ä¶ FALSE http‚Ä¶
##  3  3.64e7 ask   gaborcsa‚Ä¶ &lt;named list&gt; FALSE   https:/‚Ä¶ Friendly C‚Ä¶ FALSE http‚Ä¶
##  4  3.49e7 base‚Ä¶ gaborcsa‚Ä¶ &lt;named list&gt; FALSE   https:/‚Ä¶ Do we get ‚Ä¶ FALSE http‚Ä¶
##  5  6.16e7 cite‚Ä¶ gaborcsa‚Ä¶ &lt;named list&gt; FALSE   https:/‚Ä¶ Test R pac‚Ä¶ TRUE  http‚Ä¶
##  6  3.39e7 clis‚Ä¶ gaborcsa‚Ä¶ &lt;named list&gt; FALSE   https:/‚Ä¶ Unicode sy‚Ä¶ FALSE http‚Ä¶
##  7  3.72e7 cmak‚Ä¶ gaborcsa‚Ä¶ &lt;named list&gt; FALSE   https:/‚Ä¶ port of cm‚Ä¶ TRUE  http‚Ä¶
##  8  6.80e7 cmark gaborcsa‚Ä¶ &lt;named list&gt; FALSE   https:/‚Ä¶ CommonMark‚Ä¶ TRUE  http‚Ä¶
##  9  6.32e7 cond‚Ä¶ gaborcsa‚Ä¶ &lt;named list&gt; FALSE   https:/‚Ä¶ &lt;NA&gt;        TRUE  http‚Ä¶
## 10  2.43e7 cray‚Ä¶ gaborcsa‚Ä¶ &lt;named list&gt; FALSE   https:/‚Ä¶ R package ‚Ä¶ FALSE http‚Ä¶
## # ‚Ä¶ with 166 more rows, and 59 more variables: forks_url &lt;chr&gt;, keys_url &lt;chr&gt;,
## #   collaborators_url &lt;chr&gt;, teams_url &lt;chr&gt;, hooks_url &lt;chr&gt;,
## #   issue_events_url &lt;chr&gt;, events_url &lt;chr&gt;, assignees_url &lt;chr&gt;,
## #   branches_url &lt;chr&gt;, tags_url &lt;chr&gt;, blobs_url &lt;chr&gt;, git_tags_url &lt;chr&gt;,
## #   git_refs_url &lt;chr&gt;, trees_url &lt;chr&gt;, statuses_url &lt;chr&gt;,
## #   languages_url &lt;chr&gt;, stargazers_url &lt;chr&gt;, contributors_url &lt;chr&gt;,
## #   subscribers_url &lt;chr&gt;, subscription_url &lt;chr&gt;, commits_url &lt;chr&gt;, ‚Ä¶
```
]

&lt;style&gt;
.panel1-gh-repos-auto-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-gh-repos-auto-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-gh-repos-auto-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



---

## ASOIAF characters


```r
chars &lt;- tibble(char = got_chars)
chars
```

```
## # A tibble: 30 √ó 1
##    char             
##    &lt;list&gt;           
##  1 &lt;named list [18]&gt;
##  2 &lt;named list [18]&gt;
##  3 &lt;named list [18]&gt;
##  4 &lt;named list [18]&gt;
##  5 &lt;named list [18]&gt;
##  6 &lt;named list [18]&gt;
##  7 &lt;named list [18]&gt;
##  8 &lt;named list [18]&gt;
##  9 &lt;named list [18]&gt;
## 10 &lt;named list [18]&gt;
## # ‚Ä¶ with 20 more rows
```

---

## ASOIAF characters


```r
chars2 &lt;- chars %&gt;%
  unnest_wider(col = char)
chars2
```

```
## # A tibble: 30 √ó 18
##    url           id name  gender culture born  died  alive titles aliases father
##    &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;lgl&gt; &lt;list&gt; &lt;list&gt;  &lt;chr&gt; 
##  1 https://w‚Ä¶  1022 Theo‚Ä¶ Male   "Ironb‚Ä¶ "In ‚Ä¶ ""    TRUE  &lt;chr&gt;  &lt;chr&gt;   ""    
##  2 https://w‚Ä¶  1052 Tyri‚Ä¶ Male   ""      "In ‚Ä¶ ""    TRUE  &lt;chr&gt;  &lt;chr&gt;   ""    
##  3 https://w‚Ä¶  1074 Vict‚Ä¶ Male   "Ironb‚Ä¶ "In ‚Ä¶ ""    TRUE  &lt;chr&gt;  &lt;chr&gt;   ""    
##  4 https://w‚Ä¶  1109 Will  Male   ""      ""    "In ‚Ä¶ FALSE &lt;chr&gt;  &lt;chr&gt;   ""    
##  5 https://w‚Ä¶  1166 Areo‚Ä¶ Male   "Norvo‚Ä¶ "In ‚Ä¶ ""    TRUE  &lt;chr&gt;  &lt;chr&gt;   ""    
##  6 https://w‚Ä¶  1267 Chett Male   ""      "At ‚Ä¶ "In ‚Ä¶ FALSE &lt;chr&gt;  &lt;chr&gt;   ""    
##  7 https://w‚Ä¶  1295 Cres‚Ä¶ Male   ""      "In ‚Ä¶ "In ‚Ä¶ FALSE &lt;chr&gt;  &lt;chr&gt;   ""    
##  8 https://w‚Ä¶   130 Aria‚Ä¶ Female "Dorni‚Ä¶ "In ‚Ä¶ ""    TRUE  &lt;chr&gt;  &lt;chr&gt;   ""    
##  9 https://w‚Ä¶  1303 Daen‚Ä¶ Female "Valyr‚Ä¶ "In ‚Ä¶ ""    TRUE  &lt;chr&gt;  &lt;chr&gt;   ""    
## 10 https://w‚Ä¶  1319 Davo‚Ä¶ Male   "Weste‚Ä¶ "In ‚Ä¶ ""    TRUE  &lt;chr&gt;  &lt;chr&gt;   ""    
## # ‚Ä¶ with 20 more rows, and 7 more variables: mother &lt;chr&gt;, spouse &lt;chr&gt;,
## #   allegiances &lt;list&gt;, books &lt;list&gt;, povBooks &lt;list&gt;, tvSeries &lt;list&gt;,
## #   playedBy &lt;list&gt;
```

---

## Nested list objects


```r
chars2 %&gt;%
  select(where(is.list))
```

```
## # A tibble: 30 √ó 7
##    titles    aliases    allegiances books     povBooks  tvSeries  playedBy 
##    &lt;list&gt;    &lt;list&gt;     &lt;list&gt;      &lt;list&gt;    &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
##  1 &lt;chr [3]&gt; &lt;chr [4]&gt;  &lt;chr [1]&gt;   &lt;chr [3]&gt; &lt;chr [2]&gt; &lt;chr [6]&gt; &lt;chr [1]&gt;
##  2 &lt;chr [2]&gt; &lt;chr [11]&gt; &lt;chr [1]&gt;   &lt;chr [2]&gt; &lt;chr [4]&gt; &lt;chr [6]&gt; &lt;chr [1]&gt;
##  3 &lt;chr [2]&gt; &lt;chr [1]&gt;  &lt;chr [1]&gt;   &lt;chr [3]&gt; &lt;chr [2]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt;
##  4 &lt;chr [1]&gt; &lt;chr [1]&gt;  &lt;NULL&gt;      &lt;chr [1]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt;
##  5 &lt;chr [1]&gt; &lt;chr [1]&gt;  &lt;chr [1]&gt;   &lt;chr [3]&gt; &lt;chr [2]&gt; &lt;chr [2]&gt; &lt;chr [1]&gt;
##  6 &lt;chr [1]&gt; &lt;chr [1]&gt;  &lt;NULL&gt;      &lt;chr [2]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt;
##  7 &lt;chr [1]&gt; &lt;chr [1]&gt;  &lt;NULL&gt;      &lt;chr [2]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt;
##  8 &lt;chr [1]&gt; &lt;chr [1]&gt;  &lt;chr [1]&gt;   &lt;chr [4]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt;
##  9 &lt;chr [5]&gt; &lt;chr [11]&gt; &lt;chr [1]&gt;   &lt;chr [1]&gt; &lt;chr [4]&gt; &lt;chr [6]&gt; &lt;chr [1]&gt;
## 10 &lt;chr [4]&gt; &lt;chr [5]&gt;  &lt;chr [2]&gt;   &lt;chr [1]&gt; &lt;chr [3]&gt; &lt;chr [5]&gt; &lt;chr [1]&gt;
## # ‚Ä¶ with 20 more rows
```

---

## Choose your own adventure

&lt;img src="https://images-na.ssl-images-amazon.com/images/I/81E88dflPeL.jpg" width="30%" style="display: block; margin: auto;" /&gt;

---

class: inverse, middle

# Every appearance per book/season

---



count: false
 
## Every appearance per book/season
.panel1-got-appearances-auto[

```r
*select(
* .data = chars2,
* name, books, tvSeries
*) 
```
]
 
.panel2-got-appearances-auto[

```
## # A tibble: 30 √ó 3
##    name               books     tvSeries 
##    &lt;chr&gt;              &lt;list&gt;    &lt;list&gt;   
##  1 Theon Greyjoy      &lt;chr [3]&gt; &lt;chr [6]&gt;
##  2 Tyrion Lannister   &lt;chr [2]&gt; &lt;chr [6]&gt;
##  3 Victarion Greyjoy  &lt;chr [3]&gt; &lt;chr [1]&gt;
##  4 Will               &lt;chr [1]&gt; &lt;chr [1]&gt;
##  5 Areo Hotah         &lt;chr [3]&gt; &lt;chr [2]&gt;
##  6 Chett              &lt;chr [2]&gt; &lt;chr [1]&gt;
##  7 Cressen            &lt;chr [2]&gt; &lt;chr [1]&gt;
##  8 Arianne Martell    &lt;chr [4]&gt; &lt;chr [1]&gt;
##  9 Daenerys Targaryen &lt;chr [1]&gt; &lt;chr [6]&gt;
## 10 Davos Seaworth     &lt;chr [1]&gt; &lt;chr [5]&gt;
## # ‚Ä¶ with 20 more rows
```
]

---
count: false
 
## Every appearance per book/season
.panel1-got-appearances-auto[

```r
select(
  .data = chars2,
  name, books, tvSeries
) %&gt;%
* pivot_longer(
*   cols = c(books, tvSeries),
*   names_to = "media",
*   values_to = "value"
* )
```
]
 
.panel2-got-appearances-auto[

```
## # A tibble: 60 √ó 3
##    name              media    value    
##    &lt;chr&gt;             &lt;chr&gt;    &lt;list&gt;   
##  1 Theon Greyjoy     books    &lt;chr [3]&gt;
##  2 Theon Greyjoy     tvSeries &lt;chr [6]&gt;
##  3 Tyrion Lannister  books    &lt;chr [2]&gt;
##  4 Tyrion Lannister  tvSeries &lt;chr [6]&gt;
##  5 Victarion Greyjoy books    &lt;chr [3]&gt;
##  6 Victarion Greyjoy tvSeries &lt;chr [1]&gt;
##  7 Will              books    &lt;chr [1]&gt;
##  8 Will              tvSeries &lt;chr [1]&gt;
##  9 Areo Hotah        books    &lt;chr [3]&gt;
## 10 Areo Hotah        tvSeries &lt;chr [2]&gt;
## # ‚Ä¶ with 50 more rows
```
]

---
count: false
 
## Every appearance per book/season
.panel1-got-appearances-auto[

```r
select(
  .data = chars2,
  name, books, tvSeries
) %&gt;%
  pivot_longer(
    cols = c(books, tvSeries),
    names_to = "media",
    values_to = "value"
  ) %&gt;%
* unnest_longer(col = value)
```
]
 
.panel2-got-appearances-auto[

```
## # A tibble: 180 √ó 3
##    name             media    value            
##    &lt;chr&gt;            &lt;chr&gt;    &lt;chr&gt;            
##  1 Theon Greyjoy    books    A Game of Thrones
##  2 Theon Greyjoy    books    A Storm of Swords
##  3 Theon Greyjoy    books    A Feast for Crows
##  4 Theon Greyjoy    tvSeries Season 1         
##  5 Theon Greyjoy    tvSeries Season 2         
##  6 Theon Greyjoy    tvSeries Season 3         
##  7 Theon Greyjoy    tvSeries Season 4         
##  8 Theon Greyjoy    tvSeries Season 5         
##  9 Theon Greyjoy    tvSeries Season 6         
## 10 Tyrion Lannister books    A Feast for Crows
## # ‚Ä¶ with 170 more rows
```
]

&lt;style&gt;
.panel1-got-appearances-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-got-appearances-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-got-appearances-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



---

class: inverse, middle

# Match character's title to their name

---



count: false
 
## Match character's title to their name
.panel1-got-title-name-auto[

```r
*select(
* .data = chars2,
* name,
* title = titles
*) 
```
]
 
.panel2-got-title-name-auto[

```
## # A tibble: 30 √ó 2
##    name               title    
##    &lt;chr&gt;              &lt;list&gt;   
##  1 Theon Greyjoy      &lt;chr [3]&gt;
##  2 Tyrion Lannister   &lt;chr [2]&gt;
##  3 Victarion Greyjoy  &lt;chr [2]&gt;
##  4 Will               &lt;chr [1]&gt;
##  5 Areo Hotah         &lt;chr [1]&gt;
##  6 Chett              &lt;chr [1]&gt;
##  7 Cressen            &lt;chr [1]&gt;
##  8 Arianne Martell    &lt;chr [1]&gt;
##  9 Daenerys Targaryen &lt;chr [5]&gt;
## 10 Davos Seaworth     &lt;chr [4]&gt;
## # ‚Ä¶ with 20 more rows
```
]

---
count: false
 
## Match character's title to their name
.panel1-got-title-name-auto[

```r
select(
  .data = chars2,
  name,
  title = titles
) %&gt;%
* unnest_longer(col = title)
```
]
 
.panel2-got-title-name-auto[

```
## # A tibble: 60 √ó 2
##    name              title                                                 
##    &lt;chr&gt;             &lt;chr&gt;                                                 
##  1 Theon Greyjoy     "Prince of Winterfell"                                
##  2 Theon Greyjoy     "Captain of Sea Bitch"                                
##  3 Theon Greyjoy     "Lord of the Iron Islands (by law of the green lands)"
##  4 Tyrion Lannister  "Acting Hand of the King (former)"                    
##  5 Tyrion Lannister  "Master of Coin (former)"                             
##  6 Victarion Greyjoy "Lord Captain of the Iron Fleet"                      
##  7 Victarion Greyjoy "Master of the Iron Victory"                          
##  8 Will              ""                                                    
##  9 Areo Hotah        "Captain of the Guard at Sunspear"                    
## 10 Chett             ""                                                    
## # ‚Ä¶ with 50 more rows
```
]

&lt;style&gt;
.panel1-got-title-name-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-got-title-name-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-got-title-name-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



---

# May the force be with you

&lt;img src="https://media.giphy.com/media/C0ZArORmrDQCRTIFnQ/giphy.gif" width="80%" style="display: block; margin: auto;" /&gt;

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "magula",
"highlightLines": true,
"highlightLanguage": "r",
"ratio": "16:9",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
